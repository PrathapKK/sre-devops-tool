<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ entity_name | capitalize }} Management</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    form { margin-bottom: 20px; }
    input, select { margin: 5px; padding: 8px; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 10px; }
  </style>
</head>
<body>

  <h1>{{ entity_name | capitalize }} Management</h1>

  <h2>Create / Edit {{ entity_name | capitalize }}</h2>
  <form id="crud-form">
    {% for field_name, field in schema.fields.items() %}
      {% if field_name != 'id' %}
        <label>{{ field_name | capitalize }}:</label>
        <input type="text" name="{{ field_name }}" required><br>
      {% endif %}
    {% endfor %}
    <button type="submit">Submit</button>
  </form>

  <h2>{{ entity_name | capitalize }} List</h2>
  <table id="data-table">
    <thead>
      <tr>
        {% for field_name in schema.fields %}
          <th>{{ field_name }}</th>
        {% endfor %}
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    const entity = "{{ entity_name }}";
    const apiBase = `/api/${entity}`;

    function fetchData() {
      fetch(apiBase)
        .then(res => res.json())
        .then(data => {
          const table = document.querySelector("#data-table tbody");
          table.innerHTML = "";
          data.forEach(item => {
            let row = "<tr>";
            {% for field_name in schema.fields %}
              row += `<td>${item["{{ field_name }}"] ?? ""}</td>`;
            {% endfor %}
            row += `<td>
                      <button onclick="editItem(${item.id})">Edit</button>
                      <button onclick="deleteItem(${item.id})">Delete</button>
                    </td>`;
            row += "</tr>";
            table.innerHTML += row;
          });
        });
    }

    function deleteItem(id) {
      fetch(`${apiBase}/${id}`, { method: "DELETE" })
        .then(() => fetchData());
    }

    function editItem(id) {
      fetch(`${apiBase}/${id}`)
        .then(res => res.json())
        .then(item => {
          document.querySelectorAll("#crud-form input").forEach(input => {
            input.value = item[input.name] || "";
          });
          document.getElementById("crud-form").dataset.editingId = id;
        });
    }

    document.getElementById("crud-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = e.target;
      const data = {};
      form.querySelectorAll("input").forEach(input => {
        data[input.name] = input.value;
      });
      const editingId = form.dataset.editingId;
      const method = editingId ? "PUT" : "POST";
      const url = editingId ? `${apiBase}/${editingId}` : apiBase;

      fetch(url, {
        method: method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(() => {
        form.reset();
        delete form.dataset.editingId;
        fetchData();
      });
    });

    fetchData();
  </script>
</body>
</html>
